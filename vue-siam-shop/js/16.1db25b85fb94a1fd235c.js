(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{1065:function(e,t,s){var a=s(1108);"string"==typeof a&&(a=[[e.i,a,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};s(276)(a,o);a.locals&&(e.exports=a.locals)},1107:function(e,t,s){"use strict";s(1065)},1108:function(e,t,s){},1183:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("section",[t("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[t("el-form",{attrs:{inline:!0,model:e.searchMsg}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"请输入商品名称搜索"},model:{value:e.searchMsg.name,callback:function(t){e.$set(e.searchMsg,"name",t)},expression:"searchMsg.name"}})],1),e._v(" "),t("el-form-item",[t("el-input",{attrs:{placeholder:"请输入商品类别搜索"},model:{value:e.searchMsg.menuName,callback:function(t){e.$set(e.searchMsg,"menuName",t)},expression:"searchMsg.menuName"}})],1),e._v(" "),t("el-form-item",[t("el-select",{attrs:{placeholder:"请选择状态搜索",clearable:""},model:{value:e.searchMsg.status,callback:function(t){e.$set(e.searchMsg,"status",t)},expression:"searchMsg.status"}},[t("el-option",{attrs:{label:"待上架",value:1}}),e._v(" "),t("el-option",{attrs:{label:"已上架",value:2}}),e._v(" "),t("el-option",{attrs:{label:"已下架",value:3}}),e._v(" "),t("el-option",{attrs:{label:"售罄",value:4}})],1)],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getList(1)}}},[e._v("查询")])],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.gotoAdd("add")}}},[e._v("新增")])],1)],1)],1),e._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"goodsTable",staticStyle:{width:"100%"},attrs:{data:e.list,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.headerCellStyle},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),t("el-table-column",{attrs:{type:"index",label:"序号",width:"50"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",[e._v(e._s((e.searchMsg.pageNo-1)*e.searchMsg.pageSize+s.$index+1))])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"id",label:"商品编号"}}),e._v(" "),t("el-table-column",{attrs:{label:"商品主图",prop:"mainImage"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("img",{attrs:{src:e.$http.publicUrl(s.row.mainImage),width:"50",height:"50"}})]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"name",label:"商品名称"}}),e._v(" "),t("el-table-column",{attrs:{prop:"menuName",label:"商品类别"}}),e._v(" "),t("el-table-column",{attrs:{prop:"price",label:"一口价",formatter:e.addUnit}}),e._v(" "),t("el-table-column",{attrs:{prop:"packingCharges",label:"包装费",formatter:e.addUnit}}),e._v(" "),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[1==s.row.status?t("span",{staticStyle:{color:"blue","font-weight":"bold"}},[e._v("待上架")]):2==s.row.status?t("span",{staticStyle:{color:"green","font-weight":"bold"}},[e._v("已上架")]):3==s.row.status?t("span",{staticStyle:{color:"grey","font-weight":"bold"}},[e._v("已下架")]):4==s.row.status?t("span",{staticStyle:{color:"red","font-weight":"bold"}},[e._v("售罄")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"saleqty",label:"已售出数量"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",[e._v(e._s(s.row.saleqty)+"份")])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",formatter:e.formatTime}}),e._v(" "),t("el-table-column",{attrs:{label:"操作",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleEdit(s.$index,s.row)}}},[e._v("编辑规格")]),e._v(" "),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.gotoAdd("edit",s.row)}}},[e._v("修改商品")]),e._v(" "),t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleDel(s.row.id)}}},[e._v("删除商品")])]}}])})],1),e._v(" "),t("el-col",{staticClass:"toolbar",attrs:{span:24}},[t("el-pagination",{staticStyle:{float:"right"},attrs:{"page-sizes":[10,20,50,100],"page-size":e.searchMsg.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),t("el-dialog",{attrs:{title:"添加规格",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t},close:e.editFormClose}},[t("div",{staticClass:"dialogDiv"},[t("el-form",{attrs:{size:"small"}},e._l(e.editForm,(function(s,a){return t("el-form-item",{key:a},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"规格名称"},model:{value:s.specificationName,callback:function(t){e.$set(s,"specificationName",t)},expression:"item.specificationName"}})],1),e._v(" "),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"规格选项名称"},model:{value:s.name,callback:function(t){e.$set(s,"name",t)},expression:"item.name"}})],1),e._v(" "),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{min:0,placeholder:"加价金额(元)"},model:{value:s.price,callback:function(t){e.$set(s,"price",t)},expression:"item.price"}})],1),e._v(" "),t("el-col",{attrs:{span:2}},[""!=s.id?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return t.preventDefault(),e.updateSpecification(s)}}},[e._v("保存")]):e._e()],1),e._v(" "),t("el-col",{attrs:{span:3}},[""!=s.id?t("el-button",{attrs:{type:"danger"},on:{click:function(t){return t.preventDefault(),e.removeSpecification(s)}}},[e._v("删除")]):e._e()],1),e._v(" "),t("el-col",{attrs:{span:3}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:a+1===e.editForm.length,expression:"index+1 === editForm.length"}],on:{click:function(t){return e.addSpecification(s)}}},[e._v("添加")])],1)],1)],1)})),1)],1)])],1)};a._withStripped=!0;var o={data:()=>({searchMsg:{pageNo:1,pageSize:20},list:[],total:0,listLoading:!1,sels:[],editFormVisible:!1,editFormRules:{specificationName:[{required:!0,message:"请输入规格名称",trigger:"change"}],name:[{required:!0,message:"请输入规格选项名称",trigger:"change"}],price:[{required:!0,message:"请输入加价金额",trigger:"blur"}]},editForm:[],searchData:[],goodsId:"",goodsTable:"",multipleSelection:[]}),methods:{cellStyle:({row:e,column:t,rowIndex:s,columnIndex:a})=>"text-align:center",headerCellStyle:({row:e,rowIndex:t})=>"text-align:center",editFormClose(){this.editForm=[]},updateSpecification(e){let t=this,s=e;if(!s.specificationName)return t.$message({showClose:!0,message:"请输入规格名称",type:"error"}),!1;if(!s.name)return t.$message({showClose:!0,message:"请输入规格选项名称",type:"error"}),!1;if(!/^[0-9]\d*$/.test(s.price))return t.$message({showClose:!0,message:"请输入正确的加价金额",type:"error"}),!1;let a=Object.assign({},s);delete a.createTime,delete a.updateTime,t.$http.post(t,"/rest/merchant/goodsSpecificationOption/update",a,(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"})}),(function(e,s){t.$message({showClose:!0,message:s.message,type:"error"})}))},removeSpecification(e){let t=this,s=e;var a=this.editForm.indexOf(s);t.$http.post(t,"/rest/merchant/goodsSpecificationOption/delete",{ids:[s.id]},(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"}),-1!==a&&(e.editForm.splice(a,1),e.editForm.length<1&&e.editForm.push({id:"",specificationName:"",name:"",price:""}))}),(function(e,s){t.$message({showClose:!0,message:s.message,type:"error"})}))},addSpecification(e){let t=this,s=e;if(!s.specificationName)return t.$message({showClose:!0,message:"请输入规格名称",type:"error"}),!1;if(!s.name)return t.$message({showClose:!0,message:"请输入规格选项名称",type:"error"}),!1;if(!/^[0-9]\d*$/.test(s.price))return t.$message({showClose:!0,message:"请输入正确的加价金额",type:"error"}),!1;let a=Object.assign({},s);a.goodsId=t.goodsId;let o="";o=a.id?"/rest/merchant/goodsSpecificationOption/update":"/rest/merchant/goodsSpecificationOption/insert",t.$http.post(t,o,a,(t,s)=>{t.$message({showClose:!0,message:s.message,type:"success"}),e.id=s.data,t.editForm.push({id:"",specificationName:"",name:"",price:""})},(e,s)=>{t.$message({showClose:!0,message:s.message,type:"error"})})},addUnit:(e,t)=>(e[t.property]||0)+"元",formatSalePrice:(e,t)=>e.isSale?e.salePrice+"元":"-",gotoAdd(e,t){"add"===e?this.$router.push({path:"addGoods"}):this.$router.push({path:"editGoods",query:{id:t.id}})},formatTime(e,t){let s=new Date(e[t.property]);return this.$utils.formatDate(s,"yyyy-MM-dd hh:mm")},formatappType:(e,t)=>1==e.apptype?"ios":"android",formatType(e,t){switch(e[t.property]){case 1:return"待上架";case 2:return"已上架";case 3:return"已下架";case 4:return"售罄"}},handleSizeChange(e){this.searchMsg.pageSize=e,this.getList()},handleCurrentChange(e){this.searchMsg.pageNo=e,this.getList()},updateStatus(e,t=1){let s="";s=1===t?"上架":"下架",this.$confirm("确认"+s+" ‘ "+e.name+" ’ ?","提示",{type:"warning"}).then(()=>{this.listLoading=!0;let s=this,a={id:e.id,goodsstatus:t};s.$http.post(s,"/rest/merchant/goods/update",a,(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"}),e.getList()}),(function(e,t){s.$message({showClose:!0,message:t.message,type:"error"})})),this.listLoading=!1}).catch(()=>{})},getList(e){e&&(this.searchMsg.pageNo=e);let t=this,s=Object.assign({},t.searchMsg,{token:sessionStorage.getItem("token")});console.log("param="+JSON.stringify(s)),console.log("searchMsg="+JSON.stringify(t.searchMsg)),t.listLoading=!0,t.$http.post(t,"/rest/merchant/goods/list",s,(e,t)=>{e.list=t.data.records,e.total=t.data.total,e.listLoading=!1},(e,s)=>{t.listLoading=!1,t.$message({showClose:!0,message:s.message,type:"error"})})},printOrderLabel(){let e=this;if(0==this.multipleSelection.length)return e.$message({showClose:!0,message:"请选择要打印标签的商品",type:"error"}),!1;let t=[];for(let e=0;e<this.multipleSelection.length;e++)t.push(this.multipleSelection[e].name);for(let e=0;e<t.length;e++){let s='[{"goodsName": "'+t[e]+'", }]';this.printGoodsLabel(s)}},printGoodsLabel(e){if(null==e||""==e)return alert("请输入订单信息"),!1;let t={ReportType:"fastreport",ReportName:"siamGoodsLabel.fr3",ReportVersion:1,ReportUrl:"",Copies:1,PrintOffsetX:0,PrintOffsetY:0,token:"aa",taskId:"1234567",exportfilename:"",exportfiletype:"",AField:'[{"type": "ftString", "name": "goodsName","size": 255,"required": false},]',AData:e};$.ajax({type:"post",url:"http://127.0.0.1:12345/printreport",async:!1,data:qs.stringify(t),success:function(e){(e=decodeURIComponent(e),console.log(e),""==e)?(printIsSuccess=!1,alert("连接HttpPrinter失败，请重新启动程序")):"ok"!=JSON.parse(e).status&&(printIsSuccess=!1,alert("打印失败，请联系管理员"))},error:function(e){printIsSuccess=!1,alert("连接HttpPrinter失败，请重新启动程序")}})},handleDel(e){this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(()=>{let t=this;t.$http.post(t,"/rest/merchant/goods/delete",{id:e},(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"}),e.getList()}),(function(e,s){t.$message({showClose:!0,message:s.message,type:"error"})}))}).catch(()=>{})},handleEdit:function(e,t){this.editFormVisible=!0,this.goodsId=t.id,this.getspecificationList()},getspecificationList(){let e=this,t={pageNo:-1,pageSize:10,goodsId:e.goodsId};e.$http.post(e,"/rest/merchant/goodsSpecificationOption/list",t,(e,t)=>{let s=t.data.records;s.length&&(e.editForm=s),e.editForm.push({id:"",specificationName:"",name:"",price:""})},(t,s)=>{e.$message({showClose:!0,message:s.message,type:"error"})})},editSubmit:function(){this.$refs.editForm.validate(e=>{if(e){let e=this,t=Object.assign({},this.editForm),s="";s=t.id?"/rest/merchant/goodsSpecificationOption/update":"/rest/merchant/goodsSpecificationOption/insert",e.$http.post(e,s,t,(e,t)=>{e.$message({showClose:!0,message:t.message,type:"success"})},(t,s)=>{e.$message({showClose:!0,message:s.message,type:"error"})})}})},handleSelectionChange(e){this.multipleSelection=e,console.log(this.multipleSelection)}},mounted(){this.getList(),this.$orderPrint.init()}},i=(s(1107),s(275)),r=Object(i.a)(o,a,[],!1,null,"58fe2c26",null);t.default=r.exports}}]);