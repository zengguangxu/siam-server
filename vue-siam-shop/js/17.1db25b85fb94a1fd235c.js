(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{1068:function(e,t,a){var l=a(1114);"string"==typeof l&&(l=[[e.i,l,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};a(276)(l,i);l.locals&&(e.exports=l.locals)},1113:function(e,t,a){"use strict";a(1068)},1114:function(e,t,a){},1191:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("section",[t("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[t("el-form",{attrs:{inline:!0,model:e.searchMsg}},[t("el-form-item",{attrs:{label:"商品名称",prop:"goodsName"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入商品名称"},model:{value:e.searchMsg.goodsName,callback:function(t){e.$set(e.searchMsg,"goodsName",t)},expression:"searchMsg.goodsName"}})],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getList(1)}}},[e._v("查询")])],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleAddRelation}},[e._v("设置配比")])],1)],1)],1),e._v(" "),t("div",{staticClass:"table-wrapper"},[t("div",{staticClass:"left-table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"goodsTable",staticStyle:{width:"100%"},attrs:{data:e.list,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.headerCellStyle},on:{"selection-change":e.handleSelectionChangeGoodsTable}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),t("el-table-column",{attrs:{prop:"goodsName",label:"商品名称"}}),e._v(" "),t("el-table-column",{attrs:{prop:"rawmaterialName",label:"原料"}}),e._v(" "),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleDetail(a.row.goodsId)}}},[e._v("查看")])]}}])})],1),e._v(" "),t("el-col",{staticClass:"toolbar",attrs:{span:24}},[t("el-pagination",{staticStyle:{float:"right"},attrs:{"page-sizes":[10,20,50,100],"page-size":e.searchMsg.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),t("div",{staticClass:"right-table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoadingRawmaterial,expression:"listLoadingRawmaterial"}],staticStyle:{width:"100%"},attrs:{data:e.listRawmaterial,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.headerCellStyle}},[t("el-table-column",{attrs:{prop:"rawmaterialName",label:"原料名称"}}),e._v(" "),t("el-table-column",{attrs:{prop:"consumedQuantity",label:"耗量",formatter:e.addUnit},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.consumedQuantity)+" "+e._s(a.row.rawmaterialUnit))])]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleEdit(a.$index,a.row)}}},[e._v("编辑")]),e._v(" "),t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleDel(a.row.id)}}},[e._v("删除")])]}}])})],1),e._v(" "),t("el-col",{staticClass:"toolbar",attrs:{span:24}},[t("el-pagination",{staticStyle:{float:"right"},attrs:{"page-sizes":[10,20,50,100],"page-size":e.searchMsg.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)]),e._v(" "),t("el-dialog",{attrs:{title:"设置配比",visible:e.editFormVisibleRelationTable,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisibleRelationTable=t},close:e.closeDialog}},[t("div",{staticClass:"dialogDiv"},[t("el-form",{ref:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"150px",rules:e.editFormRules}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoadingRelationTable,expression:"listLoadingRelationTable"}],ref:"relationTable",staticStyle:{width:"100%"},attrs:{data:e.listRelationTable,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.headerCellStyle},on:{"selection-change":e.handleSelectionChangeRelationTable}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),t("el-table-column",{attrs:{prop:"name",label:"原料"}}),e._v(" "),t("el-table-column",{attrs:{prop:"consumedQuantity",label:"耗量"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{type:"number",placeholder:"请输入耗量"},model:{value:e.consumedQuantityRelationTable[a.row.id],callback:function(t){e.$set(e.consumedQuantityRelationTable,a.row.id,t)},expression:"consumedQuantityRelationTable[scope.row.id]"}})]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"unit",label:"单位"}})],1)],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){e.editFormVisibleRelationTable=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.editLoadingRelationTable},nativeOn:{click:function(t){return e.editSubmitRelationTable.apply(null,arguments)}}},[e._v("提交")])],1)]),e._v(" "),t("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t},close:e.closeDialog}},[t("el-form",{ref:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"150px",rules:e.editFormRules}},[t("el-form-item",{attrs:{label:"原料名称",prop:"rawmaterialName"}},[t("el-input",{attrs:{disabled:""},model:{value:e.editForm.rawmaterialName,callback:function(t){e.$set(e.editForm,"rawmaterialName",t)},expression:"editForm.rawmaterialName"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"耗量",prop:"consumedQuantity"}},[t("el-input",{model:{value:e.editForm.consumedQuantity,callback:function(t){e.$set(e.editForm,"consumedQuantity",t)},expression:"editForm.consumedQuantity"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"采购单位",prop:"rawmaterialUnit"}},[t("el-input",{attrs:{disabled:""},model:{value:e.editForm.rawmaterialUnit,callback:function(t){e.$set(e.editForm,"rawmaterialUnit",t)},expression:"editForm.rawmaterialUnit"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit.apply(null,arguments)}}},[e._v("提交")])],1)],1)],1)};l._withStripped=!0;a(28);a(277);var i={data:()=>({searchMsg:{pageNo:1,pageSize:20},list:[],total:0,listLoading:!1,sels:[],goodsTable:"",multipleSelectionGoodsTable:[],editFormVisible:!1,editLoading:!1,editFormRules:{name:[{required:!0,message:"请输入辅料名称",trigger:"blur"}],price:[{required:!1,message:"请输入单价",trigger:"blur"}],stock:[{required:!0,message:"请选择库存",trigger:"change"}]},editForm:{name:"",price:"",stock:!1},searchMsgRawmaterial:{pageNo:1,pageSize:20},listRawmaterial:[],totalRawmaterial:0,listLoadingRawmaterial:!1,selsRawmaterial:[],goodsIdRawmaterialTable:"",editFormVisibleRelationTable:!1,editLoadingRelationTable:!1,relationTable:"",multipleSelectionRelationTable:[],searchMsgRelationTable:{pageNo:-1,pageNoIndex:1,pageSize:20},listRelationTable:[],totalRelationTable:0,listLoadingRelationTable:!1,selsRelationTable:[],goodsIdRelationTable:[],consumedQuantityRelationTable:[]}),methods:{cellStyle:({row:e,column:t,rowIndex:a,columnIndex:l})=>"text-align:center",headerCellStyle:({row:e,rowIndex:t})=>"text-align:center",closeDialog(){this.$refs.editForm.resetFields()},formatTime(e,t){let a=new Date(e[t.property]),l=this.$utils.formatDate(a,"yyyy-MM-dd hh:mm:ss");return null!=e[t.property]&&"1970-01-01 08:00:00"!=l||(l="-"),l},formatType:(e,t)=>1==e.stock?"有货":"无货",addUnit:(e,t)=>(e[t.property]||0)+"元",handleSizeChange(e){this.searchMsg.pageSize=e,this.getList()},handleCurrentChange(e){this.searchMsg.pageNo=e,this.getList()},getList(e){e&&(this.searchMsg.pageNo=e);let t=this,a=Object.assign(t.searchMsg);t.listLoading=!0,t.$http.post(t,"/rest/merchant/goodsRawmaterialRelation/find/goodsRawmaterialRelation",a,(e,t)=>{e.list=t.data.records,e.total=t.data.total,e.listLoading=!1},(e,a)=>{t.listLoading=!1,t.$message({showClose:!0,message:a.message,type:"error"})})},handleDetail(e){this.goodsIdRawmaterialTable=e;let t=this;t.listLoadingRawmaterial=!0;let a=Object.assign(t.searchMsgRawmaterial);a.goodsId=e,t.$http.post(t,"/rest/merchant/goodsRawmaterialRelation/find/goodsRawmaterialRelationByGoodsId",a,(function(e,t){e.listRawmaterial=t.data.records,e.totalRawmaterial=t.data.total,e.listLoadingRawmaterial=!1}),(function(e,a){t.$message({showClose:!0,message:a.message,type:"error"})}))},handleDel(e){this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(()=>{let t=this;t.$http.delete(t,"/rest/merchant/goodsRawmaterialRelation/delete",{id:e},(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"}),e.handleDetail(e.goodsIdRawmaterialTable),e.getList()}),(function(e,a){t.$message({showClose:!0,message:a.message,type:"error"})}))}).catch(()=>{})},handleEdit:function(e,t){this.editFormVisible=!0,this.editForm=t?{id:t.id,rawmaterialName:t.rawmaterialName,consumedQuantity:t.consumedQuantity,rawmaterialUnit:t.rawmaterialUnit}:{rawmaterialName:"",consumedQuantity:"",rawmaterialUnit:""}},editSubmit:function(){this.$refs.editForm.validate(e=>{if(e){let e=this,t=Object.assign({},this.editForm),a="";delete t.rawmaterialName,delete t.rawmaterialUnit,a="/rest/merchant/goodsRawmaterialRelation/update",e.$http.put(e,a,t,(e,t)=>{e.$message({showClose:!0,message:t.message,type:"success"}),e.handleDetail(e.goodsIdRawmaterialTable),e.editFormVisible=!1},(t,a)=>{e.editFormVisible=!1,e.$message({showClose:!0,message:a.message,type:"error"})})}})},getListRelationTable(){let e=this,t=Object.assign(e.searchMsgRelationTable);e.listLoadingRelationTable=!0,e.$http.post(e,"/rest/merchant/rawmaterial/list",t,(e,t)=>{e.listRelationTable=t.data.records,e.totalRelationTable=t.data.total,e.listLoadingRelationTable=!1},(t,a)=>{e.listLoadingRelationTable=!1,e.$message({showClose:!0,message:a.message,type:"error"})})},handleAddRelation(e){let t=this;if(0==this.multipleSelectionGoodsTable.length)return t.$message({showClose:!0,message:"请选择要配比原料的商品",type:"error"}),!1;this.$nextTick((function(){this.toggleSelectionSingleRelationTable()})),this.consumedQuantityRelationTable=[],this.editFormVisibleRelationTable=!0,this.goodsIdRelationTable=this.multipleSelectionGoodsTable,console.log("点击原料配比，选中的商品id如下："),console.log(this.goodsIdRelationTable)},editSubmitRelationTable:function(){let e=this,t={goodsIdListStr:[],relationListStr:[]},a="";if(0==this.multipleSelectionRelationTable.length)return e.$message({showClose:!0,message:"请选择要配比的原料",type:"error"}),!1;console.log("点击原料配比，选中的商品id如下："),console.log(this.goodsIdRelationTable),console.log(this.multipleSelectionRelationTable),console.log(this.consumedQuantityRelationTable);let l=[];for(let e=0;e<this.goodsIdRelationTable.length;e++)l.push(this.goodsIdRelationTable[e].goodsId);t.goodsIdListStr=JSON.stringify(l);let i=[];for(let t=0;t<this.multipleSelectionRelationTable.length;t++){let a=this.consumedQuantityRelationTable[this.multipleSelectionRelationTable[t].id];if(null==a||""==a)return e.$message({showClose:!0,message:"请填写"+this.multipleSelectionRelationTable[t].name+"原料的耗量",type:"error"}),!1;let l={rawmaterialId:this.multipleSelectionRelationTable[t].id,consumedQuantity:a};i.push(l)}t.relationListStr=JSON.stringify(i),a="/rest/merchant/goodsRawmaterialRelation/insert",e.$http.post(e,"/rest/merchant/goodsRawmaterialRelation/insert",t,(e,t)=>{e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(),null!=e.goodsIdRawmaterialTable&&""!=e.goodsIdRawmaterialTable&&e.handleDetail(e.goodsIdRawmaterialTable),e.editFormVisibleRelationTable=!1,this.$nextTick((function(){this.toggleSelectionSingleGoodsTable()}))},(t,a)=>{e.editFormVisibleRelationTable=!1,e.$message({showClose:!0,message:a.message,type:"error"}),this.$nextTick((function(){this.toggleSelectionSingleGoodsTable()}))})},toggleSelection(e){e?e.forEach(e=>{this.$refs.relationTable.toggleRowSelection(e)}):this.$refs.relationTable.clearSelection()},toggleSelectionSingleGoodsTable(e){e?this.$refs.goodsTable.toggleRowSelection(e):this.$refs.goodsTable.clearSelection()},toggleSelectionSingleRelationTable(e){e?this.$refs.relationTable.toggleRowSelection(e):this.$refs.relationTable.clearSelection()},handleSelectionChangeGoodsTable(e){this.multipleSelectionGoodsTable=e,console.log(this.multipleSelectionGoodsTable)},handleSelectionChangeRelationTable(e){this.multipleSelectionRelationTable=e,console.log(this.multipleSelectionRelationTable)},change(e){this.$forceUpdate()}},mounted(){this.getList(),this.getListRelationTable(),this.$orderPrint.init()}},o=(a(1113),a(275)),s=Object(o.a)(i,l,[],!1,null,"7eb0e8ec",null);t.default=s.exports}}]);