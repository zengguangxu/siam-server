(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1062:function(e,t,i){var s=i(1112);"string"==typeof s&&(s=[[e.i,s,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(277)(s,o);s.locals&&(e.exports=s.locals)},1111:function(e,t,i){"use strict";i(1062)},1112:function(e,t,i){},1144:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("section",[t("el-form",{ref:"editForm",staticClass:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"150px",rules:e.editFormRules}},[t("el-form-item",{attrs:{label:"分类名称",prop:"name"}},[t("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),t("el-form-item",{staticClass:"iconFileItem",attrs:{label:"分类图标（宽400px * 高400px）",prop:"iconFile"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{accept:".image, .png, .jpg",action:"",multiple:"",name:"iconUpload","on-remove":e.handleRemoveIcon,"file-list":e.editForm.iconFile,"before-upload":e.beforeAvatarUpload,"http-request":e.upload,"list-type":"picture-card"}},[t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.editForm.description,callback:function(t){e.$set(e.editForm,"description",t)},expression:"editForm.description"}})],1)],1),e._v(" "),t("div",{staticClass:"el-dialog__footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.goBack}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.saveGoodsMsg}},[e._v("保存")])],1)],1)};s._withStripped=!0;var o={data:()=>({menuList:[],editForm:{isDisabled:!1,name:"",description:"",iconFile:[]},editFormRules:{isDisabled:[{required:!0,message:"请选择分类状态",trigger:"change"}],name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],description:[{required:!1,message:"请输入分类描述",trigger:"blur"}],iconFile:[{type:"array",required:!0,message:"请上传分类图标",trigger:"change"}]}}),methods:{saveGoodsMsg(){this.$refs.editForm.validate(e=>{if(e){this.editLoading=!0;let e=this;if(!e.editForm.iconFile.length)return e.$message({showClose:!0,message:"请上传商品分类图标",type:"error"}),!1;if(e.editForm.iconFile.length>1)return e.$message({showClose:!0,message:"只能上传一张商品分类图标",type:"error"}),!1;let t=Object.assign({},this.editForm);t.icon=e.getIdByArr(t.iconFile),delete t.iconFile,delete t.createTime,delete t.updateTime;let i="";t.id?(i="/rest/admin/pointsMall/menu/update",e.$http.put(e,i,t,(e,t)=>{this.editLoading=!1,e.$message({showClose:!0,message:t.message,type:"success"}),e.goBack(),e.editFormVisible=!1},(t,i)=>{e.editFormVisible=!1,e.$message({showClose:!0,message:i.message,type:"error"})})):(i="/rest/admin/pointsMall/menu/insert",e.$http.post(e,i,t,(e,t)=>{this.editLoading=!1,e.$message({showClose:!0,message:t.message,type:"success"}),e.goBack(),e.editFormVisible=!1},(t,i)=>{e.editFormVisible=!1,e.$message({showClose:!0,message:i.message,type:"error"})}))}})},goBack(){this.$refs.editForm.resetFields(),this.$router.push({path:"pointsMall_menuList"})},getIdByArr:e=>(e||[]).map(e=>e.oldUrl).join(","),removeDomain(e){var t=this.editForm.standData.indexOf(e);-1!==t&&this.editForm.standData.splice(t,1)},addDomain(){this.editForm.standData.push({stand:"",stock:""})},getDetail(e){let t=this;t.$http.post(t,"/rest/admin/pointsMall/menu/getById",{id:e},(e,t)=>{let i=t.data;i.iconFile=e.resetImg(i,"icon"),e.editForm=Object.assign({},i)},(e,i)=>{t.$message({showClose:!0,message:i.message,type:"error"})})},resetImg(e,t){if(e[t]){let i=e[t].split(","),s=[],o=0;return i.forEach(e=>{let t={url:this.$http.publicUrl(e),oldUrl:e,name:o+1};s.push(t),o++}),s}return[]},getTypeList(){let e=this;e.$http.post(e,"/rest/admin/pointsMall/menu/list",{pageNo:-1,pageSize:10,typestatus:0},(e,t)=>{e.menuList=t.data.records},(t,i)=>{e.$message({showClose:!0,message:i.message,type:"error"})})},handleRemoveSubImages(e,t){let i=this.editForm.subImagesFile;this.editForm.subImagesFile=i.filter((function(t){return t.uid!==e.uid}))},handleRemoveDetailImages(e,t){let i=this.editForm.detailImagesFile;this.editForm.detailImagesFile=i.filter((function(t){return t.uid!==e.uid}))},beforeAvatarUpload(e){const t=e.size/1024/1024<6;return t||this.$message({showClose:!0,message:"上传图片大小不能超过 6MB!",type:"error"}),t},handleRemoveIcon(e,t){let i=this.editForm.iconFile;this.editForm.iconFile=i.filter((function(t){return t.uid!==e.uid}))},upload(e){let t=e.file,i=new FormData;i.append("file",t),this.$http.postupload(this,"/rest/admin/uploadSingleImage",i,(function(t,i){e.onSuccess();let s={oldUrl:i.data,url:t.$http.publicUrl(i.data),uid:e.file.uid};"subImagesUpload"===e.filename?t.editForm.subImagesFile.push(s):"detailImagesUpload"===e.filename?t.editForm.detailImagesFile.push(s):t.editForm.iconFile.push(s)}),(function(t){e.onError()}))}},created(){this.getTypeList();let e=this.$route.query.id;this.getDetail(e),this.$orderPrint.init()}},a=(i(1111),i(276)),r=Object(a.a)(o,s,[],!1,null,"56208f8c",null);t.default=r.exports}}]);