(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{1073:function(e,t,i){var l=i(1134);"string"==typeof l&&(l=[[e.i,l,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};i(277)(l,a);l.locals&&(e.exports=l.locals)},1133:function(e,t,i){"use strict";i(1073)},1134:function(e,t,i){},1146:function(e,t,i){"use strict";i.r(t);var l=function(){var e=this,t=e._self._c;return t("section",[t("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[t("el-form",{attrs:{inline:!0,model:e.searchMsg}},[t("el-form-item",{attrs:{label:"优惠券名称",prop:"name"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入优惠券名称"},model:{value:e.searchMsg.name,callback:function(t){e.$set(e.searchMsg,"name",t)},expression:"searchMsg.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"优惠券类型",prop:"preferentialType"}},[t("el-select",{attrs:{clearable:""},model:{value:e.searchMsg.preferentialType,callback:function(t){e.$set(e.searchMsg,"preferentialType",t)},expression:"searchMsg.preferentialType"}},[t("el-option",{attrs:{label:"折扣优惠券",value:1}})],1)],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getList(1)}}},[e._v("查询")])],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleEditDiscount}},[e._v("新增折扣优惠券")])],1)],1)],1),e._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.list,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.headerCellStyle}},[t("el-table-column",{attrs:{prop:"id",label:"优惠券编号"}}),e._v(" "),t("el-table-column",{attrs:{prop:"name",label:"优惠券名称"}}),e._v(" "),t("el-table-column",{attrs:{prop:"preferentialType",label:"优惠券类型"},scopedSlots:e._u([{key:"default",fn:function(i){return[1==i.row.preferentialType?t("span",[e._v("折扣优惠券")]):2==i.row.preferentialType?t("span",[e._v("满减优惠券")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"discountAmount",label:"折扣额度",formatter:e.formatPreferentialType1}}),e._v(" "),t("el-table-column",{attrs:{prop:"limitedPrice",label:"满足价格",formatter:e.formatPreferentialType2}}),e._v(" "),t("el-table-column",{attrs:{prop:"reducedPrice",label:"减价额度",formatter:e.formatPreferentialType2}}),e._v(" "),t("el-table-column",{attrs:{prop:"description",label:"使用规则描述",width:"190"}}),e._v(" "),t("el-table-column",{attrs:{prop:"validType",label:"时效"},scopedSlots:e._u([{key:"default",fn:function(i){return[1==i.row.validType?t("span",[e._v("绝对时效")]):2==i.row.validType?t("span",[e._v("相对时效")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"validStartTime",label:"使用开始时间",formatter:e.formatValidType1,width:"190"}}),e._v(" "),t("el-table-column",{attrs:{prop:"validEndTime",label:"使用结束时间",formatter:e.formatValidType1,width:"190"}}),e._v(" "),t("el-table-column",{attrs:{prop:"validDays",label:"有效天数",formatter:e.formatValidType2}}),e._v(" "),t("el-table-column",{attrs:{prop:"validDays",label:"已发放张数"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.gaveCount)+"张")])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"validDays",label:"已使用张数"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.usedCount)+"张")])]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"260"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleRelationGoods(i.row.id)}}},[e._v("关联商品")]),e._v(" "),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleEdit(i.$index,i.row)}}},[e._v("编辑")]),e._v(" "),t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleDel(i.row.id)}}},[e._v("删除")]),e._v(" "),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleGiveCoupons(i.row.id)}}},[e._v("群发优惠券")])]}}])})],1),e._v(" "),t("el-col",{staticClass:"toolbar",attrs:{span:24}},[t("el-pagination",{staticStyle:{float:"right"},attrs:{"page-sizes":[10,20,50,100],"page-size":e.searchMsg.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),t("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t},close:e.closeDialog}},[t("el-form",{ref:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"210px",rules:e.editFormRules}},[t("el-form-item",{attrs:{label:"优惠券名称",prop:"name"}},[t("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"折扣额度（0折=0、5折=0.5）",prop:"discountAmount"}},[t("el-input",{attrs:{type:"number"},model:{value:e.editForm.discountAmount,callback:function(t){e.$set(e.editForm,"discountAmount",t)},expression:"editForm.discountAmount"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"使用规则描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.editForm.description,callback:function(t){e.$set(e.editForm,"description",t)},expression:"editForm.description"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"时效",prop:"validType"}},[t("el-radio-group",{attrs:{size:"medium"},model:{value:e.editForm.validType,callback:function(t){e.$set(e.editForm,"validType",t)},expression:"editForm.validType"}},[t("el-radio-button",{attrs:{label:"使用时间段",value:"1"}}),e._v(" "),t("el-radio-button",{attrs:{label:"使用天数",value:"2"}})],1)],1),e._v(" "),"使用时间段"==e.editForm.validType?t("el-form-item",{attrs:{label:"使用开始时间（00:00:00）",prop:"validStartTime"}},[t("el-date-picker",{attrs:{"value-format":"timestamp",format:"yyyy/MM/dd",type:"datetime",placeholder:"选择使用开始时间"},model:{value:e.editForm.validStartTime,callback:function(t){e.$set(e.editForm,"validStartTime",t)},expression:"editForm.validStartTime"}})],1):e._e(),e._v(" "),"使用时间段"==e.editForm.validType?t("el-form-item",{attrs:{label:"使用结束时间（00:00:00）",prop:"validEndTime"}},[t("el-date-picker",{attrs:{"value-format":"timestamp",format:"yyyy/MM/dd",type:"datetime",placeholder:"选择使用结束时间"},model:{value:e.editForm.validEndTime,callback:function(t){e.$set(e.editForm,"validEndTime",t)},expression:"editForm.validEndTime"}})],1):e._e(),e._v(" "),"使用天数"==e.editForm.validType?t("el-form-item",{attrs:{label:"有效天数",prop:"validDays"}},[t("el-input",{model:{value:e.editForm.validDays,callback:function(t){e.$set(e.editForm,"validDays",t)},expression:"editForm.validDays"}})],1):e._e()],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit.apply(null,arguments)}}},[e._v("提交")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisibleFullReduction,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisibleFullReduction=t},close:e.closeDialog}},[t("el-form",{ref:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"210px",rules:e.editFormRules}},[t("el-form-item",{attrs:{label:"优惠券名称",prop:"name"}},[t("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"满足价格",prop:"limitedPrice"}},[t("el-input",{model:{value:e.editForm.limitedPrice,callback:function(t){e.$set(e.editForm,"limitedPrice",t)},expression:"editForm.limitedPrice"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"减价额度",prop:"reducedPrice"}},[t("el-input",{model:{value:e.editForm.reducedPrice,callback:function(t){e.$set(e.editForm,"reducedPrice",t)},expression:"editForm.reducedPrice"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"使用规则描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.editForm.description,callback:function(t){e.$set(e.editForm,"description",t)},expression:"editForm.description"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"时效",prop:"validType"}},[t("el-radio-group",{attrs:{size:"medium"},model:{value:e.editForm.validType,callback:function(t){e.$set(e.editForm,"validType",t)},expression:"editForm.validType"}},[t("el-radio-button",{attrs:{label:"绝对时效",value:"1"}}),e._v(" "),t("el-radio-button",{attrs:{label:"相对时效",value:"2"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"使用开始时间（00:00:00）",prop:"validStartTime"}},[t("el-date-picker",{attrs:{"value-format":"timestamp",format:"yyyy/MM/dd",type:"datetime",placeholder:"选择使用开始时间"},model:{value:e.editForm.validStartTime,callback:function(t){e.$set(e.editForm,"validStartTime",t)},expression:"editForm.validStartTime"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"使用结束时间（00:00:00）",prop:"validEndTime"}},[t("el-date-picker",{attrs:{"value-format":"timestamp",format:"yyyy/MM/dd",type:"datetime",placeholder:"选择使用结束时间"},model:{value:e.editForm.validEndTime,callback:function(t){e.$set(e.editForm,"validEndTime",t)},expression:"editForm.validEndTime"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"有效天数",prop:"validDays"}},[t("el-input",{model:{value:e.editForm.validDays,callback:function(t){e.$set(e.editForm,"validDays",t)},expression:"editForm.validDays"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){e.editFormVisibleFullReduction=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.editLoadingFullReduction},nativeOn:{click:function(t){return e.editSubmitFullReduction.apply(null,arguments)}}},[e._v("提交")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"关联商品",visible:e.editFormVisibleGoodsTable,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisibleGoodsTable=t},close:e.closeDialog}},[t("div",{staticClass:"dialogDiv"},[t("el-form",{ref:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"150px",rules:e.editFormRules}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoadingGoodsTable,expression:"listLoadingGoodsTable"}],ref:"goodsTable",staticStyle:{width:"100%"},attrs:{data:e.listGoodsTable,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.headerCellStyle},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),t("el-table-column",{attrs:{label:"商品主图",prop:"mainImage"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("img",{attrs:{src:e.$http.publicUrl(i.row.mainImage),width:"50",height:"50"}})]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"name",label:"商品名称"}}),e._v(" "),t("el-table-column",{attrs:{prop:"menuName",label:"类别"}}),e._v(" "),t("el-table-column",{attrs:{prop:"price",label:"一口价",formatter:e.addUnit}})],1)],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){e.editFormVisibleGoodsTable=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.editLoadingGoodsTable},nativeOn:{click:function(t){return e.editSubmitGoodsTable.apply(null,arguments)}}},[e._v("提交")])],1)])],1)};l._withStripped=!0;var a={data:()=>({searchMsg:{pageNo:1,pageSize:20},list:[],total:0,listLoading:!1,sels:[],editFormVisible:!1,editLoading:!1,editFormVisibleFullReduction:!1,editLoadingFullReduction:!1,editFormRules:{name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],preferentialType:[{required:!0,message:"请输入优惠类型",trigger:"blur"}],discountAmount:[{required:!0,message:"请输入折扣额度",trigger:"blur"}],limitedPrice:[{required:!0,message:"请输入满足价格",trigger:"blur"}],reducedPrice:[{required:!0,message:"请输入减价额度",trigger:"blur"}],description:[{required:!0,message:"请输入使用规则描述",trigger:"blur"}],validType:[{required:!0,message:"请选择时效",trigger:"blur"}],validStartTime:[{required:!1,message:"请选择使用开始时间",trigger:"blur"}],validEndTime:[{required:!1,message:"请选择使用结束时间",trigger:"blur"}],validDays:[{required:!1,message:"请输入自领取之日起有效天数",trigger:"blur"}]},editForm:{name:"",preferentialType:"",discountAmount:"",limitedPrice:"",reducedPrice:"",description:"",validType:"",validStartTime:"",validEndTime:"",validDays:""},editFormVisibleGoodsTable:!1,editLoadingGoodsTable:!1,goodsTable:"",multipleSelection:[],searchMsgGoodsTable:{pageNo:-1,pageNoIndex:1,pageSize:20},listGoodsTable:[],totalGoodsTable:0,listLoadingGoodsTable:!1,selsGoodsTable:[],couponsIdGoodsTable:""}),methods:{cellStyle:({row:e,column:t,rowIndex:i,columnIndex:l})=>"text-align:center",headerCellStyle:({row:e,rowIndex:t})=>"text-align:center",closeDialog(){this.$refs.editForm.resetFields()},formatTime(e,t){let i=new Date(e[t.property]),l=this.$utils.formatDate(i,"yyyy-MM-dd hh:mm:ss");return null!=e[t.property]&&"1970-01-01 08:00:00"!=l||(l="-"),l},formatValidType1(e,t){if(1==e.validType){let i=new Date(e[t.property]),l=this.$utils.formatDate(i,"yyyy-MM-dd hh:mm:ss");return"1970-01-01"==l&&(l="-"),l}return"-"},formatValidType2:(e,t)=>2==e.validType?e.validDays+"天":"-",formatType:(e,t)=>1==e.status?"开启":"关闭",addUnit:(e,t)=>(e[t.property]||0)+"元",formatPreferentialType1:(e,t)=>1==e.preferentialType?10*e[t.property]+"折":"-",formatPreferentialType2:(e,t)=>2==e.preferentialType?(e[t.property]||0)+"元":"-",formatSalePrice:(e,t)=>e.isSale?e.salePrice+"元":"-",handleSizeChange(e){this.searchMsg.pageSize=e,this.getList()},handleCurrentChange(e){this.searchMsg.pageNo=e,this.getList()},getList(e){e&&(this.searchMsg.pageNo=e);let t=this,i=Object.assign(t.searchMsg);t.listLoading=!0,i.isDelete=0,t.$http.post(t,"/rest/admin/pointsMall/coupons/list",i,(e,t)=>{e.list=t.data.records,e.total=t.data.total,e.listLoading=!1},(e,i)=>{t.listLoading=!1,t.$message({showClose:!0,message:i.message,type:"error"})})},handleDel(e){this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(()=>{let t=this;t.$http.delete(t,"/rest/admin/pointsMall/coupons/delete",{id:e},(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"}),e.getList()}),(function(e,i){t.$message({showClose:!0,message:i.message,type:"error"})}))}).catch(()=>{})},handleGiveCoupons(e){let t=this;t.$http.post(t,"/rest/admin/pointsMall/couponsMemberRelation/giveCoupons",{couponsId:e},(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"}),e.getList()}),(function(e,i){t.$message({showClose:!0,message:i.message,type:"error"})}))},handleEdit:function(e,t){1==t.preferentialType?this.editFormVisible=!0:this.editFormVisibleFullReduction=!0,this.editForm=t?{id:t.id,name:t.name,preferentialType:1==t.preferentialType?"折扣":"满减",discountAmount:1==t.preferentialType?t.discountAmount:"",limitedPrice:2==t.preferentialType?t.limitedPrice:"",reducedPrice:2==t.preferentialType?t.reducedPrice:"",description:t.description,validType:1==t.validType?"使用时间段":"使用天数",validStartTime:1==t.validType?new Date(t.validStartTime).getTime():"",validEndTime:1==t.validType?new Date(t.validEndTime).getTime():"",validDays:2==t.validType?t.validDays:""}:{name:"",preferentialType:"",discountAmount:"",limitedPrice:"",reducedPrice:"",description:"",validType:"",validStartTime:"",validEndTime:"",validDays:""}},handleEditDiscount:function(e,t){this.editFormVisible=!0,this.editForm=t?{id:t.id,name:t.name,preferentialType:1==t.preferentialType?"折扣":"满减",discountAmount:1==t.preferentialType?t.discountAmount:"",limitedPrice:2==t.preferentialType?t.limitedPrice:"",reducedPrice:2==t.preferentialType?t.reducedPrice:"",description:t.description,validType:1==t.validType?"绝对时效":"相对时效",validStartTime:1==t.validType?new Date(t.validStartTime).getTime():"",validEndTime:1==t.validType?new Date(t.validEndTime).getTime():"",validDays:2==t.validType?t.validDays:""}:{name:"",preferentialType:"",discountAmount:"",limitedPrice:"",reducedPrice:"",description:"",validType:"",validStartTime:"",validEndTime:"",validDays:""}},handleEditFullReduction:function(e,t){this.editFormVisibleFullReduction=!0,this.editForm=t?{id:t.id,name:t.name,preferentialType:1==t.preferentialType?"折扣":"满减",discountAmount:1==t.preferentialType?t.discountAmount:"",limitedPrice:2==t.preferentialType?t.limitedPrice:"",reducedPrice:2==t.preferentialType?t.reducedPrice:"",description:t.description,validType:1==t.validType?"绝对时效":"相对时效",validStartTime:1==t.validType?new Date(t.validStartTime).getTime():"",validEndTime:1==t.validType?new Date(t.validEndTime).getTime():"",validDays:2==t.validType?t.validDays:""}:{name:"",preferentialType:"",discountAmount:"",limitedPrice:"",reducedPrice:"",description:"",validType:"",validStartTime:"",validEndTime:"",validDays:""}},editSubmit:function(){this.$refs.editForm.validate(e=>{if(e){let e=this,t=Object.assign({},this.editForm),i="";if(t.preferentialType=1,t.validType="使用时间段"==t.validType?1:2,""==t.discountAmount.toString)return e.$message({showClose:!0,message:"请填写折扣额度",type:"error"}),!1;if(t.discountAmount<0||t.discountAmount>=1)return e.$message({showClose:!0,message:"请填写正确的折扣额度",type:"error"}),!1;if(delete t.limitedPrice,delete t.reducedPrice,1==t.validType){if(""==t.validStartTime)return e.$message({showClose:!0,message:"请填写使用开始时间",type:"error"}),!1;if(""==t.validEndTime)return e.$message({showClose:!0,message:"请填写使用结束时间",type:"error"}),!1;let i=new Date(t.validEndTime);i.setHours(0),i.setMinutes(0),i.setSeconds(0);let l=new Date(t.validStartTime);if(l.setHours(0),l.setMinutes(0),l.setSeconds(0),i<=l)return e.$message({showClose:!0,message:"使用结束时间必须大于使用开始时间",type:"error"}),!1;delete t.validDays;let a=new Date(t.validStartTime),s=this.$utils.formatDate(a,"yyyy/MM/dd");t.validStartTime=s;let o=new Date(t.validEndTime);s=this.$utils.formatDate(o,"yyyy/MM/dd"),t.validEndTime=s}else if(2==t.validType){if(""==t.validDays)return e.$message({showClose:!0,message:"请填写有效天数",type:"error"}),!1;delete t.validStartTime,delete t.validEndTime}this.editLoading=!0,t.id?(i="/rest/admin/pointsMall/coupons/update",e.$http.put(e,i,t,(e,t)=>{this.editLoading=!1,e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(),e.editFormVisible=!1},(t,i)=>{e.editFormVisible=!1,e.$message({showClose:!0,message:i.message,type:"error"})})):(i="/rest/admin/pointsMall/coupons/insert",e.$http.post(e,i,t,(e,t)=>{this.editLoading=!1,e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(),e.editFormVisible=!1},(t,i)=>{e.editFormVisible=!1,e.$message({showClose:!0,message:i.message,type:"error"})}))}})},editSubmitFullReduction:function(){this.$refs.editForm.validate(e=>{if(e){let e=this,t=Object.assign({},this.editForm),i="";if(t.preferentialType=2,t.validType="绝对时效"==t.validType?1:2,""==t.limitedPrice)return e.$message({showClose:!0,message:"请填写满足额度",type:"error"}),!1;if(""==t.reducedPrice)return e.$message({showClose:!0,message:"请填写减价额度",type:"error"}),!1;if(parseFloat(t.reducedPrice)>=parseFloat(t.limitedPrice))return e.$message({showClose:!0,message:"减价额度必须小于满足价格",type:"error"}),!1;if(delete t.discountAmount,1==t.validType){if(""==t.validStartTime)return e.$message({showClose:!0,message:"请填写使用开始时间",type:"error"}),!1;if(""==t.validEndTime)return e.$message({showClose:!0,message:"请填写使用结束时间",type:"error"}),!1;let i=new Date(t.validEndTime);i.setHours(0),i.setMinutes(0),i.setSeconds(0);let l=new Date(t.validStartTime);if(l.setHours(0),l.setMinutes(0),l.setSeconds(0),i<=l)return e.$message({showClose:!0,message:"使用结束时间必须大于使用开始时间",type:"error"}),!1;delete t.validDays;let a=new Date(t.validStartTime),s=this.$utils.formatDate(a,"yyyy/MM/dd");t.validStartTime=s;let o=new Date(t.validEndTime);s=this.$utils.formatDate(o,"yyyy/MM/dd"),t.validEndTime=s}else if(2==t.validType){if(""==t.validDays)return e.$message({showClose:!0,message:"请填写有效天数",type:"error"}),!1;delete t.validStartTime,delete t.validEndTime}this.editLoadingFullReduction=!0,t.id?(i="/rest/admin/pointsMall/coupons/update",e.$http.put(e,i,t,(e,t)=>{this.editLoadingFullReduction=!1,e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(),e.editFormVisibleFullReduction=!1},(t,i)=>{e.editFormVisibleFullReduction=!1,e.$message({showClose:!0,message:i.message,type:"error"})})):(i="/rest/admin/pointsMall/coupons/insert",e.$http.post(e,i,t,(e,t)=>{this.editLoadingFullReduction=!1,e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(),e.editFormVisibleFullReduction=!1},(t,i)=>{e.editFormVisibleFullReduction=!1,e.$message({showClose:!0,message:i.message,type:"error"})}))}})},getListGoodsTable(){let e=this,t=Object.assign({},e.searchMsgGoodsTable,{token:sessionStorage.getItem("token")});console.log("param="+JSON.stringify(t)),console.log("searchMsg="+JSON.stringify(e.searchMsgGoodsTable)),e.listLoadingGoodsTable=!0,e.$http.post(e,"/rest/admin/pointsMall/goods/list",t,(e,t)=>{e.listGoodsTable=t.data.records,e.totalGoodsTable=t.data.total,e.listLoadingGoodsTable=!1},(t,i)=>{e.listLoadingGoodsTable=!1,e.$message({showClose:!0,message:i.message,type:"error"})})},handleRelationGoods(e){this.$nextTick((function(){this.toggleSelectionSingle()})),this.editFormVisibleGoodsTable=!0,this.couponsIdGoodsTable=e;let t=this;t.$http.post(t,"/rest/admin/pointsMall/coupons/selectById",{id:e},(e,t)=>{let i=t.data.goodsList;if(i.length>0)for(let e=0;e<i.length;e++)for(let t=0;t<this.listGoodsTable.length;t++)if(i[e].id==this.listGoodsTable[t].id){this.toggleSelectionSingle(this.listGoodsTable[t]);break}console.log(this.multipleSelection)},(e,i)=>{t.$message({showClose:!0,message:i.message,type:"error"})})},editSubmitGoodsTable:function(){let e=this,t={couponsId:this.couponsIdGoodsTable,goodsIdListStr:""},i="";if(0==this.multipleSelection.length)return e.$message({showClose:!0,message:"请选择要关联的商品",type:"error"}),!1;let l=[];for(let e=0;e<this.multipleSelection.length;e++)l.push(this.multipleSelection[e].id);t.goodsIdListStr=JSON.stringify(l),this.editLoadingGoodsTable=!0,i="/rest/admin/pointsMall/couponsGoodsRelation/insert",e.$http.post(e,"/rest/admin/pointsMall/couponsGoodsRelation/insert",t,(e,t)=>{this.editLoadingGoodsTable=!1,e.$message({showClose:!0,message:t.message,type:"success"}),e.editFormVisibleGoodsTable=!1},(t,i)=>{e.editFormVisibleGoodsTable=!1,e.$message({showClose:!0,message:i.message,type:"error"})})},toggleSelection(e){e?e.forEach(e=>{this.$refs.goodsTable.toggleRowSelection(e)}):this.$refs.goodsTable.clearSelection()},toggleSelectionSingle(e){e?this.$refs.goodsTable.toggleRowSelection(e):this.$refs.goodsTable.clearSelection()},handleSelectionChange(e){this.multipleSelection=e,console.log(this.multipleSelection)}},mounted(){this.getList(),this.getListGoodsTable(),this.$orderPrint.init()}},s=(i(1133),i(276)),o=Object(s.a)(a,l,[],!1,null,"3643f492",null);t.default=o.exports}}]);