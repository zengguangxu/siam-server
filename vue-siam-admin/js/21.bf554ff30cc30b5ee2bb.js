(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1052:function(e,t,i){var a=i(1092);"string"==typeof a&&(a=[[e.i,a,""]]);var l={hmr:!0,transform:void 0,insertInto:void 0};i(277)(a,l);a.locals&&(e.exports=a.locals)},1091:function(e,t,i){"use strict";i(1052)},1092:function(e,t,i){},1151:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("section",[t("div",{staticClass:"todayBox"},[t("div",{staticClass:"totdayBlock blue"},[t("p",{staticClass:"todayBlockTitle"},[e._v("充值成功金额")]),e._v(" "),t("p",{staticClass:"todayBlockNum"},[t("span",[e._v("￥"+e._s(e.todayList.rechargeSuccessfulAmount||0))])])])]),e._v(" "),t("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[t("el-form",{attrs:{inline:!0,model:e.searchMsg}},[t("el-form-item",{attrs:{label:"订单编号",prop:"orderNo"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入订单编号"},model:{value:e.searchMsg.orderNo,callback:function(t){e.$set(e.searchMsg,"orderNo",t)},expression:"searchMsg.orderNo"}})],1),e._v(" "),t("el-form-item",{attrs:{label:""}},[t("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.searchMsg.createTime,callback:function(t){e.$set(e.searchMsg,"createTime",t)},expression:"searchMsg.createTime"}})],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getList(1)}}},[e._v("查询")])],1)],1)],1),e._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.list,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.headerCellStyle}},[t("el-table-column",{attrs:{prop:"username",label:"用户名"}}),e._v(" "),t("el-table-column",{attrs:{prop:"mobile",label:"手机号"}}),e._v(" "),t("el-table-column",{attrs:{prop:"orderNo",label:"订单编号"}}),e._v(" "),t("el-table-column",{attrs:{prop:"channel",label:"充值渠道"},scopedSlots:e._u([{key:"default",fn:function(i){return[1==i.row.channel?t("span",[e._v("小程序")]):2==i.row.channel?t("span",[e._v("商家端")]):3==i.row.channel?t("span",[e._v("调度后台")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"amount",label:"\t充值费用"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.amount)+"元")])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"denominationName",label:"充值面额名称",width:"190"}}),e._v(" "),t("el-table-column",{attrs:{prop:"denominationPrice",label:"售价"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.denominationPrice)+"元")])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"denominationIsSale",label:"是否开启促销"},scopedSlots:e._u([{key:"default",fn:function(i){return[1==i.row.denominationIsSale?t("span",[e._v("是")]):0==i.row.denominationIsSale?t("span",[e._v("否")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"denominationSalePrice",label:"折扣价"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.denominationSalePrice)+"元")])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"denominationIsGiveBalance",label:"充值后是否赠送余额"},scopedSlots:e._u([{key:"default",fn:function(i){return[1==i.row.denominationIsGiveBalance?t("span",[e._v("是")]):0==i.row.denominationIsGiveBalance?t("span",[e._v("否")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"denominationGiveBalance",label:"赠送余额数量"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.denominationGiveBalance)+"元")])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"denominationIsGiveCoupons",label:"充值后是否赠送优惠券"},scopedSlots:e._u([{key:"default",fn:function(i){return[1==i.row.denominationIsGiveCoupons?t("span",[e._v("是")]):0==i.row.denominationIsGiveCoupons?t("span",[e._v("否")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"denominationGiveCouponsDescription",label:"赠送的优惠券描述"}}),e._v(" "),t("el-table-column",{attrs:{prop:"status",label:"\t交易状态"},scopedSlots:e._u([{key:"default",fn:function(i){return[1==i.row.status?t("span",[e._v("待支付")]):2==i.row.status?t("span",[e._v("支付成功")]):e._e(),e._v(" "),3==i.row.status?t("span",[e._v("支付失败")]):e._e(),e._v(" "),4==i.row.status?t("span",[e._v("交易超时自动关闭")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",formatter:e.formatTime}})],1),e._v(" "),t("el-col",{staticClass:"toolbar",attrs:{span:24}},[t("el-pagination",{staticStyle:{float:"right"},attrs:{"page-sizes":[10,20,50,100],"page-size":e.searchMsg.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),t("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t},close:e.closeDialog}},[t("el-form",{ref:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"210px",rules:e.editFormRules}},[t("el-form-item",{attrs:{label:"充值面额名称",prop:"name"}},[t("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"价格",prop:"price"}},[t("el-input",{attrs:{type:"number"},model:{value:e.editForm.price,callback:function(t){e.$set(e.editForm,"price",t)},expression:"editForm.price"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"是否开启促销",prop:"isSale"}},[t("el-radio-group",{attrs:{size:"medium"},on:{change:e.chooseisshow},model:{value:e.editForm.isSale,callback:function(t){e.$set(e.editForm,"isSale",t)},expression:"editForm.isSale"}},[t("el-radio-button",{attrs:{label:"是",value:"1"}}),e._v(" "),t("el-radio-button",{attrs:{label:"否",value:"0"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{visible:e.editsalePrice,label:"折扣价",prop:"salePrice"},on:{"update:visible":function(t){e.editsalePrice=t}}},[t("el-input",{attrs:{type:"number"},model:{value:e.editForm.salePrice,callback:function(t){e.$set(e.editForm,"salePrice",t)},expression:"editForm.salePrice"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"简短展示文本",prop:"briefDescription"}},[t("el-input",{model:{value:e.editForm.briefDescription,callback:function(t){e.$set(e.editForm,"briefDescription",t)},expression:"editForm.briefDescription"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"充值面额描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.editForm.description,callback:function(t){e.$set(e.editForm,"description",t)},expression:"editForm.description"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"充值后是否赠送余额",prop:"isGiveBalance"}},[t("el-radio-group",{attrs:{size:"medium"},model:{value:e.editForm.isGiveBalance,callback:function(t){e.$set(e.editForm,"isGiveBalance",t)},expression:"editForm.isGiveBalance"}},[t("el-radio-button",{attrs:{label:"是",value:"1"}}),e._v(" "),t("el-radio-button",{attrs:{label:"否",value:"0"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"赠送余额数量",prop:"giveBalance"}},[t("el-input",{attrs:{type:"number"},model:{value:e.editForm.giveBalance,callback:function(t){e.$set(e.editForm,"giveBalance",t)},expression:"editForm.giveBalance"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"充值后是否赠送优惠券",prop:"isGiveCoupons"}},[t("el-radio-group",{attrs:{size:"medium"},model:{value:e.editForm.isGiveCoupons,callback:function(t){e.$set(e.editForm,"isGiveCoupons",t)},expression:"editForm.isGiveCoupons"}},[t("el-radio-button",{attrs:{label:"是",value:"1"}}),e._v(" "),t("el-radio-button",{attrs:{label:"否",value:"0"}})],1)],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit.apply(null,arguments)}}},[e._v("提交")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisibleFullReduction,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisibleFullReduction=t},close:e.closeDialog}},[t("el-form",{ref:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"210px",rules:e.editFormRules}},[t("el-form-item",{attrs:{label:"优惠券名称",prop:"name"}},[t("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"满足价格",prop:"limitedPrice"}},[t("el-input",{model:{value:e.editForm.limitedPrice,callback:function(t){e.$set(e.editForm,"limitedPrice",t)},expression:"editForm.limitedPrice"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"减价额度",prop:"reducedPrice"}},[t("el-input",{model:{value:e.editForm.reducedPrice,callback:function(t){e.$set(e.editForm,"reducedPrice",t)},expression:"editForm.reducedPrice"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"使用规则描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.editForm.description,callback:function(t){e.$set(e.editForm,"description",t)},expression:"editForm.description"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"时效",prop:"validType"}},[t("el-radio-group",{attrs:{size:"medium"},model:{value:e.editForm.validType,callback:function(t){e.$set(e.editForm,"validType",t)},expression:"editForm.validType"}},[t("el-radio-button",{attrs:{label:"绝对时效",value:"1"}}),e._v(" "),t("el-radio-button",{attrs:{label:"相对时效",value:"2"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"使用开始时间（00:00:00）",prop:"validStartTime"}},[t("el-date-picker",{attrs:{"value-format":"timestamp",format:"yyyy/MM/dd",type:"datetime",placeholder:"选择使用开始时间"},model:{value:e.editForm.validStartTime,callback:function(t){e.$set(e.editForm,"validStartTime",t)},expression:"editForm.validStartTime"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"使用结束时间（00:00:00）",prop:"validEndTime"}},[t("el-date-picker",{attrs:{"value-format":"timestamp",format:"yyyy/MM/dd",type:"datetime",placeholder:"选择使用结束时间"},model:{value:e.editForm.validEndTime,callback:function(t){e.$set(e.editForm,"validEndTime",t)},expression:"editForm.validEndTime"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"有效天数",prop:"validDays"}},[t("el-input",{model:{value:e.editForm.validDays,callback:function(t){e.$set(e.editForm,"validDays",t)},expression:"editForm.validDays"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){e.editFormVisibleFullReduction=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.editLoadingFullReduction},nativeOn:{click:function(t){return e.editSubmitFullReduction.apply(null,arguments)}}},[e._v("提交")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"关联赠送优惠劵",visible:e.editFormVisibleShopTable,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisibleShopTable=t},close:e.closeDialog}},[t("div",{staticClass:"dialogDiv"},[t("el-form",{ref:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"150px",rules:e.editFormRules}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoadingShopTable,expression:"listLoadingShopTable"}],ref:"shopTable",staticStyle:{width:"100%"},attrs:{data:e.listShopTable,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.headerCellStyle},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),t("el-table-column",{attrs:{prop:"name",label:"优惠卷名称"}}),e._v(" "),t("el-table-column",{attrs:{prop:"consumedQuantity",label:"奖励数量"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",placeholder:"请输入奖励数量"},model:{value:e.consumedQuantityRelationTable[i.row.id],callback:function(t){e.$set(e.consumedQuantityRelationTable,i.row.id,t)},expression:"consumedQuantityRelationTable[scope.row.id]"}})]}}])})],1)],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){e.editFormVisibleShopTable=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.editLoadingShopTable},nativeOn:{click:function(t){return e.editSubmitShopTable.apply(null,arguments)}}},[e._v("提交")])],1)])],1)};a._withStripped=!0;var l={data:()=>({pickerOptions:{shortcuts:[{text:"最近一周",onClick(e){const t=new Date;let i=new Date;i.setTime(t.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近两周",onClick(e){const t=new Date;let i=new Date;i.setTime(t.getTime()-12096e5),e.$emit("pick",[i,t])}},{text:"最近一月",onClick(e){const t=new Date;let i=new Date;i.setTime(t.getTime()-2592e6),e.$emit("pick",[i,t])}},{text:"最近三月",onClick(e){const t=new Date;let i=new Date;i.setTime(t.getTime()-7776e6),e.$emit("pick",[i,t])}},{text:"最近半年",onClick(e){const t=new Date;let i=new Date;i.setTime(t.getTime()-15552e6),e.$emit("pick",[i,t])}},{text:"最近一年",onClick(e){const t=new Date;let i=new Date;i.setTime(t.getTime()-31104e6),e.$emit("pick",[i,t])}},{text:"最近两年",onClick(e){const t=new Date;let i=new Date;i.setTime(t.getTime()-62208e6),e.$emit("pick",[i,t])}},{text:"最近三年",onClick(e){const t=new Date;let i=new Date;i.setTime(t.getTime()-93312e6),e.$emit("pick",[i,t])}}]},todayList:{},searchMsg:{pageNo:1,pageSize:20},list:[],total:0,listLoading:!1,sels:[],editFormVisible:!1,editLoading:!1,editsalePrice:!1,editFormVisibleFullReduction:!1,editLoadingFullReduction:!1,editFormRules:{price:[{required:!0,message:"请输入售价",trigger:"blur"}],isGiveCoupons:[{required:!0,message:"请选择是否赠送优惠券",trigger:"blur"}],description:[{required:!0,message:"请输入充值面额描述",trigger:"blur"}],name:[{required:!0,message:"请输入充值面额名称",trigger:"blur"}],description:[{required:!0,message:"请输入充值面额描述",trigger:"blur"}],briefDescription:[{required:!0,message:"请输入简短展示文本",trigger:"blur"}],validEndTime:[{required:!1,message:"请选择使用结束时间",trigger:"blur"}],validDays:[{required:!1,message:"请输入自领取之日起有效天数",trigger:"blur"}]},editForm:{name:"",preferentialType:"",discountAmount:"",limitedPrice:"",reducedPrice:"",description:"",validType:"",validStartTime:"",validEndTime:"",validDays:""},editFormVisibleShopTable:!1,editLoadingShopTable:!1,shopTable:"",multipleSelection:[],searchMsgShopTable:{pageNo:-1,pageNoIndex:1,pageSize:20},listShopTable:[],totalShopTable:0,listLoadingShopTable:!1,selsShopTable:[],couponsIdShopTable:"",consumedQuantityRelationTable:[]}),methods:{cellStyle:({row:e,column:t,rowIndex:i,columnIndex:a})=>"text-align:center",headerCellStyle:({row:e,rowIndex:t})=>"text-align:center",closeDialog(){this.$refs.editForm.resetFields()},formatTime(e,t){let i=new Date(e[t.property]),a=this.$utils.formatDate(i,"yyyy-MM-dd hh:mm:ss");return null!=e[t.property]&&"1970-01-01 08:00:00"!=a||(a="-"),a},formatValidType1(e,t){if(1==e.validType){let i=new Date(e[t.property]),a=this.$utils.formatDate(i,"yyyy-MM-dd hh:mm:ss");return"1970-01-01"==a&&(a="-"),a}return"-"},chooseisshow(e,t){1==e.isSale?this.editsalePrice=!0:this.editsalePrice=!1},formatValidType2:(e,t)=>2==e.validType?e.validDays+"天":"-",formatType:(e,t)=>1==e.status?"开启":"关闭",addUnit:(e,t)=>(e[t.property]||0)+"元",formatPreferentialType1:(e,t)=>1==e.preferentialType?10*e[t.property]+"折":"-",formatPreferentialType2:(e,t)=>2==e.preferentialType?(e[t.property]||0)+"元":"-",handleSizeChange(e){this.searchMsg.pageSize=e,this.getList()},handleCurrentChange(e){this.searchMsg.pageNo=e,this.getList()},getList(e){e&&(this.searchMsg.pageNo=e);let t=this,i=Object.assign(t.searchMsg);if(t.listLoading=!0,t.searchMsg.createTime){let e=t.searchMsg.createTime[0],a=t.searchMsg.createTime[1];i.startCreateTime=this.$utils.formatDate(new Date(e),"yyyy/MM/dd hh:mm:ss"),i.endCreateTime=this.$utils.formatDate(new Date(a),"yyyy/MM/dd hh:mm:ss"),delete i.createTime}t.$http.post(t,"/rest/admin/vipRechargeRecord/list",i,(e,t)=>{e.list=t.data.records,e.total=t.data.total,e.listLoading=!1},(e,i)=>{alert(i),t.listLoading=!1,t.$message({showClose:!0,message:i.message,type:"error"})}),t.$http.post(t,"/rest/admin/vipRechargeRecord/statisticalAmount",i,(e,t)=>{e.todayList.rechargeSuccessfulAmount=Number(t.data.rechargeSuccessfulAmount).toFixed(2),this.$forceUpdate()},(e,i)=>{t.$message({showClose:!0,message:i.message,type:"error"})})},handleDel(e){this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(()=>{let t=this;t.$http.delete(t,"/rest/admin/vipRechargeDenomination/delete",{id:e},(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"}),e.getList()}),(function(e,i){t.$message({showClose:!0,message:i.message,type:"error"})}))}).catch(()=>{})},handleGiveCoupons(e){let t=this;t.$http.post(t,"/rest/admin/couponsMemberRelation/giveCoupons",{couponsId:e},(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"}),e.getList()}),(function(e,i){t.$message({showClose:!0,message:i.message,type:"error"})}))},handleEdit:function(e,t){this.editFormVisible=!0,this.editForm=t?{id:t.id,price:t.price,name:t.name,salePrice:t.salePrice,briefDescription:t.briefDescription,isGiveBalance:1==t.isGiveBalance?"是":"否",isGiveCoupons:1==t.isGiveCoupons?"是":"否",isSale:1==t.isSale?"是":"否",giveBalance:t.giveBalance,discountAmount:1==t.preferentialType?t.discountAmount:"",limitedPrice:2==t.preferentialType?t.limitedPrice:"",reducedPrice:2==t.preferentialType?t.reducedPrice:"",description:t.description,validType:1==t.validType?"绝对时效":"相对时效",validStartTime:1==t.validType?new Date(t.validStartTime).getTime():"",validEndTime:1==t.validType?new Date(t.validEndTime).getTime():"",validDays:2==t.validType?t.validDays:""}:{name:"",preferentialType:"",discountAmount:"",limitedPrice:"",reducedPrice:"",description:"",validType:"",validStartTime:"",validEndTime:"",validDays:"",isSale:"否"}},handleEditDiscount:function(e,t){this.editFormVisible=!0,this.editForm=t?{id:t.id,name:t.name,preferentialType:1==t.preferentialType?"折扣":"满减",discountAmount:1==t.preferentialType?t.discountAmount:"",limitedPrice:2==t.preferentialType?t.limitedPrice:"",reducedPrice:2==t.preferentialType?t.reducedPrice:"",description:t.description,validType:1==t.validType?"绝对时效":"相对时效",validStartTime:1==t.validType?new Date(t.validStartTime).getTime():"",validEndTime:1==t.validType?new Date(t.validEndTime).getTime():"",validDays:2==t.validType?t.validDays:""}:{name:"",preferentialType:"",discountAmount:"",limitedPrice:"",reducedPrice:"",description:"",validType:"",validStartTime:"",validEndTime:"",validDays:"",isSale:"否",isGiveBalance:"否"}},handleEditFullReduction:function(e,t){this.editFormVisibleFullReduction=!0,this.editForm=t?{id:t.id,name:t.name,preferentialType:1==t.preferentialType?"折扣":"满减",discountAmount:1==t.preferentialType?t.discountAmount:"",limitedPrice:2==t.preferentialType?t.limitedPrice:"",reducedPrice:2==t.preferentialType?t.reducedPrice:"",description:t.description,validType:1==t.validType?"绝对时效":"相对时效",validStartTime:1==t.validType?new Date(t.validStartTime).getTime():"",validEndTime:1==t.validType?new Date(t.validEndTime).getTime():"",validDays:2==t.validType?t.validDays:""}:{name:"",preferentialType:"",discountAmount:"",limitedPrice:"",reducedPrice:"",description:"",validType:"",validStartTime:"",validEndTime:"",validDays:""}},editSubmit:function(){this.$refs.editForm.validate(e=>{if(e){let e=this,t=Object.assign({},this.editForm),i="";t.isGiveBalance="是"==t.isGiveBalance?1:0,t.isGiveCoupons="是"==t.isGiveCoupons?1:0,t.isSale="是"==t.isSale?1:0,t.id?(i="/rest/admin/vipRechargeDenomination/update",e.$http.put(e,i,t,(e,t)=>{e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(),e.editFormVisible=!1},(t,i)=>{e.editFormVisible=!1,e.$message({showClose:!0,message:i.message,type:"error"})})):(i="/rest/admin/vipRechargeDenomination/insert",e.$http.post(e,i,t,(e,t)=>{e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(),e.editFormVisible=!1},(t,i)=>{e.editFormVisible=!1,e.$message({showClose:!0,message:i.message,type:"error"})}))}})},editSubmitFullReduction:function(){this.$refs.editForm.validate(e=>{if(e){let e=this,t=Object.assign({},this.editForm),i="";if(t.source=2,t.preferentialType=2,t.validType="绝对时效"==t.validType?1:2,""==t.limitedPrice)return e.$message({showClose:!0,message:"请填写满足额度",type:"error"}),!1;if(""==t.reducedPrice)return e.$message({showClose:!0,message:"请填写减价额度",type:"error"}),!1;if(parseFloat(t.reducedPrice)>=parseFloat(t.limitedPrice))return e.$message({showClose:!0,message:"减价额度必须小于满足价格",type:"error"}),!1;if(delete t.discountAmount,1==t.validType){if(""==t.validStartTime)return e.$message({showClose:!0,message:"请填写使用开始时间",type:"error"}),!1;if(""==t.validEndTime)return e.$message({showClose:!0,message:"请填写使用结束时间",type:"error"}),!1;let i=new Date(t.validEndTime);i.setHours(0),i.setMinutes(0),i.setSeconds(0);let a=new Date(t.validStartTime);if(a.setHours(0),a.setMinutes(0),a.setSeconds(0),i<=a)return e.$message({showClose:!0,message:"使用结束时间必须大于使用开始时间",type:"error"}),!1;delete t.validDays;let l=new Date(t.validStartTime),s=this.$utils.formatDate(l,"yyyy/MM/dd");t.validStartTime=s;let o=new Date(t.validEndTime);s=this.$utils.formatDate(o,"yyyy/MM/dd"),t.validEndTime=s}else if(2==t.validType){if(""==t.validDays)return e.$message({showClose:!0,message:"请填写有效天数",type:"error"}),!1;delete t.validStartTime,delete t.validEndTime}t.id?(i="/rest/admin/coupons/update",e.$http.put(e,i,t,(e,t)=>{e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(),e.editFormVisibleFullReduction=!1},(t,i)=>{e.editFormVisibleFullReduction=!1,e.$message({showClose:!0,message:i.message,type:"error"})})):(i="/rest/admin/coupons/insert",e.$http.post(e,i,t,(e,t)=>{e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(),e.editFormVisibleFullReduction=!1},(t,i)=>{e.editFormVisibleFullReduction=!1,e.$message({showClose:!0,message:i.message,type:"error"})}))}})},getListShopTable(){let e=this,t=Object.assign({},e.searchMsgShopTable,{token:sessionStorage.getItem("token")});console.log("param="+JSON.stringify(t)),console.log("searchMsg="+JSON.stringify(e.searchMsgShopTable)),e.listLoadingShopTable=!0,e.$http.post(e,"/rest/admin/coupons/list",t,(e,t)=>{e.listShopTable=t.data.records,e.totalShopTable=t.data.total,e.listLoadingShopTable=!1},(t,i)=>{e.listLoadingShopTable=!1,e.$message({showClose:!0,message:i.message,type:"error"})})},handleRelationShop(e){this.$nextTick((function(){this.toggleSelectionSingle()})),this.consumedQuantityRelationTable=[],this.editFormVisibleShopTable=!0,this.couponsIdShopTable=e;let t=this,i=Object.assign(t.searchMsg);i.vipRechargeDenominationId=e,t.$http.post(t,"/rest/admin/coupons/list",i,(e,t)=>{let i=t.data.records;if(i.length>0)for(let e=0;e<i.length;e++)for(let t=0;t<this.listShopTable.length;t++)if(i[e].id==this.listShopTable[t].id){this.toggleSelectionSingle(this.listShopTable[t]);break}console.log(this.multipleSelection)},(e,i)=>{t.$message({showClose:!0,message:i.message,type:"error"})})},editSubmitShopTable:function(){let e=this,t={vipRechargeDenominationId:this.couponsIdShopTable},i="";if(0==this.multipleSelection.length)return e.$message({showClose:!0,message:"请选择要关联的优惠劵",type:"error"}),!1;let a=[];for(let e=0;e<this.multipleSelection.length;e++)a.push(this.multipleSelection[e].id);let l=[];for(let t=0;t<this.multipleSelection.length;t++){let i=this.consumedQuantityRelationTable[this.multipleSelection[t].id];if(null==i||""==i)return e.$message({showClose:!0,message:"请填写"+this.multipleSelection[t].name+"奖励数量",type:"error"}),!1;let a={couponsId:this.multipleSelection[t].id,giveQuantity:i};l.push(a)}t.denominationCouponsRelationListStr=JSON.stringify(l),i="/rest/admin/vipRechargeDenominationCouponsRelation/insert",e.$http.post(e,"/rest/admin/vipRechargeDenominationCouponsRelation/insert",t,(e,t)=>{e.$message({showClose:!0,message:t.message,type:"success"}),e.editFormVisibleShopTable=!1},(t,i)=>{e.editFormVisibleShopTable=!1,e.$message({showClose:!0,message:i.message,type:"error"})})},toggleSelection(e){e?e.forEach(e=>{this.$refs.shopTable.toggleRowSelection(e)}):this.$refs.shopTable.clearSelection()},toggleSelectionSingle(e){e?this.$refs.shopTable.toggleRowSelection(e):this.$refs.shopTable.clearSelection()},handleSelectionChange(e){this.multipleSelection=e,console.log(this.multipleSelection)}},mounted(){this.getList(),this.getListShopTable(),this.$orderPrint.init()}},s=(i(1091),i(276)),o=Object(s.a)(l,a,[],!1,null,"9352ed34",null);t.default=o.exports}}]);