(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{1159:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("section",[t("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[t("el-form",{attrs:{inline:!0,model:e.searchMsg}},[t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.printOrderDetail}},[e._v("打印")]),e._v(" "),t("el-button",{on:{click:e.backHistory}},[e._v("返回")])],1)],1)],1),e._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.relatedListLoading,expression:"relatedListLoading"}],staticStyle:{width:"100%"},attrs:{data:e.relatedList,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.getRowClass}},[t("el-table-column",{attrs:{prop:"orderNo",label:"订单编号",width:"200"}}),e._v(" "),t("el-table-column",{attrs:{prop:"queueNo",label:"取餐号"}}),e._v(" "),t("el-table-column",{attrs:{prop:"description",label:"订单描述"}}),e._v(" "),t("el-table-column",{attrs:{prop:"goodsTotalPrice",label:"订单总额"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("span",[e._v(e._s(r.row.goodsTotalPrice+r.row.packingCharges+r.row.deliveryFee)+"元")])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"actualPrice",label:"实付款",formatter:e.addUnit}}),e._v(" "),t("el-table-column",{attrs:{prop:"goodsTotalQuantity",label:"商品总数量"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("span",[e._v(e._s(r.row.goodsTotalQuantity)+"件")])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"goodsTotalPrice",label:"商品总金额",formatter:e.addUnit}}),e._v(" "),t("el-table-column",{attrs:{prop:"packingCharges",label:"包装费",formatter:e.addUnit}}),e._v(" "),t("el-table-column",{attrs:{prop:"deliveryFee",label:"配送费",formatter:e.addUnit}}),e._v(" "),t("el-table-column",{attrs:{prop:"fullReductionRuleDescription",label:"使用的满减规则描述",width:"190"}}),e._v(" "),t("el-table-column",{attrs:{prop:"couponsDescription",label:"使用的优惠卷描述",width:"190"}}),e._v(" "),t("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e._v(" "),t("el-table-column",{attrs:{prop:"shoppingWay",label:"购物方式",formatter:e.formatShoppingWay}}),e._v(" "),t("el-table-column",{attrs:{prop:"contactRealname",label:"联系人姓名",width:"120"}}),e._v(" "),t("el-table-column",{attrs:{prop:"contactPhone",label:"联系电话",width:"120"}}),e._v(" "),t("el-table-column",{attrs:{prop:"contactProvince",label:"派送地址",width:"190"},scopedSlots:e._u([{key:"default",fn:function(r){return[1==r.row.shoppingWay?t("span",[e._v(" - ")]):e._e(),e._v(" "),2==r.row.shoppingWay?t("span",[e._v(e._s(r.row.contactProvince)+" - "+e._s(r.row.contactCity)+" - "+e._s(r.row.contactArea)+" - "+e._s(r.row.contactStreet)+" - "+e._s(r.row.contactHouseNumber))]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"status",label:"订单状态",width:"100",formatter:e.formatOrder}}),e._v(" "),t("el-table-column",{attrs:{prop:"createTime",label:"下单时间",formatter:e.formatTime,width:"190"}})],1),e._v(" "),t("br"),t("br"),e._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.list,"highlight-current-row":"","cell-style":e.cellStyle,"header-cell-style":e.headerCellStyle}},[t("el-table-column",{attrs:{label:"商品主图",prop:"mainImage"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("img",{attrs:{src:e.$http.publicUrl(r.row.mainImage),width:"50",height:"50"}})]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"goodsName",label:"商品名称"}}),e._v(" "),t("el-table-column",{attrs:{prop:"specList",label:"商品规格",formatter:e.formatSpecList}}),e._v(" "),t("el-table-column",{attrs:{prop:"price",label:"价格",formatter:e.addUnit}}),e._v(" "),t("el-table-column",{attrs:{prop:"number",label:"购买数量",formatter:e.formatNumber}}),e._v(" "),t("el-table-column",{attrs:{prop:"subtotal",label:"小计",formatter:e.addUnit}})],1),e._v(" "),t("el-col",{staticClass:"toolbar",attrs:{span:24}},[t("el-pagination",{staticStyle:{float:"right"},attrs:{"page-sizes":[10,20,50,100],"page-size":e.searchMsg.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),t("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t},close:e.closeDialog}},[t("el-form",{ref:"editForm",staticStyle:{width:"80%"},attrs:{model:e.editForm,"label-width":"150px",rules:e.editFormRules}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"金额(元)",prop:"amount"}},[t("el-input",{model:{value:e.editForm.amount,callback:function(t){e.$set(e.editForm,"amount",t)},expression:"editForm.amount"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.editForm.remarks,callback:function(t){e.$set(e.editForm,"remarks",t)},expression:"editForm.remarks"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"产生时间",prop:"createTime"}},[t("el-date-picker",{attrs:{"value-format":"timestamp",format:"yyyy/MM/dd hh:mm:ss",type:"datetime",placeholder:"选择产生时间"},model:{value:e.editForm.createTime,callback:function(t){e.$set(e.editForm,"createTime",t)},expression:"editForm.createTime"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit.apply(null,arguments)}}},[e._v("提交")])],1)],1)],1)};a._withStripped=!0;r(28);var s=r(49),i=r.n(s);const o=r(187);var l=new Audio("https://siam-hangzhou.oss-cn-hangzhou.aliyuncs.com/data/file/order_tip.mp3"),n=1,p={data:()=>({fundList:[],searchMsg:{pageNo:1,pageSize:20},relatedList:[],relatedListLoading:!1,list:[],total:0,listLoading:!1,sels:[],editFormVisible:!1,editLoading:!1,editFormRules:{name:[{required:!0,message:"请选择名称",trigger:"change"}],amount:[{required:!0,message:"请输入买入金额",trigger:"change"}],createTime:[{required:!0,message:"请输入产生时间",trigger:"blur"}]},editForm:{name:"",amount:"",remarks:"",createTime:""}}),methods:{cellStyle:({row:e,column:t,rowIndex:r,columnIndex:a})=>"text-align:center",headerCellStyle:({row:e,rowIndex:t})=>"text-align:center",getRowClass:({row:e,column:t,rowIndex:r,columnIndex:a})=>0==r?"text-align:center;background:#F5F7FA":"",closeDialog(){this.$refs.editForm.resetFields()},formatNumber:(e,t)=>(e[t.property]||0)+"件",formatSpecList(e,t){let r="",a=JSON.parse(e.specList);for(var s in a)r+=""==r?a[s]:"/"+a[s];return r},addUnit:(e,t)=>(e[t.property]||0)+"元",formatShoppingWay:(e,t)=>1==e.shoppingWay?"自取":2==e.shoppingWay?"配送":"-",formatDescription:(e,t)=>null!=e.description?e.description.replace(/&nbsp;/g," "):"-",formatTime(e,t){let r=new Date(e[t.property]);return this.$utils.formatDate(r,"yyyy-MM-dd hh:mm")},formatOrder(e,t){switch(e[t.property]){case 1:return"未付款";case 2:return"待处理";case 3:return"待自取";case 4:return"待配送";case 5:return"已配送";case 6:return"已完成";case 7:return"售后处理中";case 8:return"已退款";case 9:return"售后处理完成";case 10:return"已取消(未支付)";case 11:return"已取消(已支付)"}},changeDecimal(e,t){return e=this.$utils.changeDecimal(e,t)},gotoOtherPage(e,t){"detail"===e&&this.$router.push({path:"editGoods",query:{id:t.id}})},backHistory(){this.$router.go(-1)},speckText(e){l.src="https://siam-hangzhou.oss-cn-hangzhou.aliyuncs.com/data/file/order_tip.mp3",l.play()},speckTextChangeToDelivery(e){l.src="https://siam-hangzhou.oss-cn-hangzhou.aliyuncs.com/data/file/order_change_to_delivery_tip.mp3",l.play()},testPlayAudio(){n%2==1?this.speckTextChangeToDelivery():this.speckText(),n++},printOrderDetail(){let e=!0;if(i.a.ajax({type:"post",url:"http://127.0.0.1:12345/printreport",async:!1,data:{},success:function(e){},error:function(t){alert("HttpPrinter.exe程序未启动"),e=!1}}),!e)return!1;let t="",r="",a=this.$route.query.id,s=this;s.$http.post(s,"/rest/admin/order/selectById",{id:a},(e,s)=>{let i=s.data,o=1==i.shoppingWay?"自取":"配送";i.isChangeToDelivery&&(o="由自取订单改为配送"),t='[{"title": "'+i.shopName+'", "shoppingWay": "配送方式：'+o+'", "nickname": "'+i.contactRealname+(0==i.contactSex?"":1==i.contactSex?"(先生)":"(女士)")+'", "mobile": "'+i.contactPhone+'", "logo": "https://siam-hangzhou.oss-cn-hangzhou.aliyuncs.com/data/images/bussiness/logo.jpg", "actualPrice": "'+i.actualPrice+'", "contactStreet": "'+i.contactStreet+'", "contactStreet": " '+(1==i.shoppingWay?"":"配送地址："+i.contactStreet)+'", "queueNumber": "'+i.queueNo+'", "packingCharges": "'+i.packingCharges+'", "deliveryFee": "'+i.deliveryFee+'", "fullReductionRuleDescription": "'+(""==i.fullReductionRuleDescription||null==i.fullReductionRuleDescription?"无":i.fullReductionRuleDescription)+'", "couponsDescription": "'+(""==i.couponsDescription||null==i.couponsDescription?"无":i.couponsDescription)+'", "remark": "'+(""==i.remark||null==i.remark?"无":i.remark)+'", }]',e.$http.post(e,"/rest/admin/orderDetail/list",{pageNo:-1,pageSize:20,orderId:a},(e,a)=>{let s=a.data.records,o="";for(let e=0;e<s.length;e++){let t=s[e],r="",a=JSON.parse(t.specList);for(var l in a)r+=""==r?a[l]:"/"+a[l];o+='{"goodsName": "'+t.goodsName+'", "specList": "('+r+')", "number": "'+t.number+'", "subtotal": "'+t.subtotal+'"},'}r="["+o+"]",this.printOrderDetailTicket(t,r);for(let e=0;e<s.length;e++){let t=s[e],r="",a=JSON.parse(t.specList);for(var l in a)r+=""==r?a[l]:"/"+a[l];o+='{"goodsName": '+t.goodsName+', "specList": "('+r+')", "number": "'+t.number+'"},';let n='[{"queueNumber": "'+i.queueNo+'", "shoppingWay": "'+(1==i.shoppingWay?"自取":"配送")+'", "goodsName": "'+t.goodsName+'", "specList": "('+r+')", }]';for(let e=0;e<t.number;e++)this.printOrderDetailLabel(n)}},(t,r)=>{e.$message({showClose:!0,message:r.message,type:"error"})})},(e,t)=>{s.$message({showClose:!0,message:t.message,type:"error"})})},printOrderDetailTicket(e,t){let r=this;if(null==e||""==e||null==t||""==t)return r.$message({showClose:!0,message:"请输入订单信息",type:"error"}),!1;let a={ReportType:"fastreport",ReportName:"siamTicket.fr3",ReportVersion:1,ReportUrl:"",Copies:1,PrintOffsetX:0,PrintOffsetY:0,token:"aa",taskId:"1234567",exportfilename:"",exportfiletype:"",AField:'[{"type": "ftString", "name": "title","size": 255,"required": true},{"type": "ftString", "name": "shoppingWay","size": 255,"required": false},{"type": "ftString", "name": "nickname","size": 255,"required": false},{"type": "ftString", "name": "mobile","size": 255,"required": false},{"type": "ftBlob", "name": "logo","size": 0,"required": false},{"type": "ftString", "name": "actualPrice","size": 255,"required": false},{"type": "ftString", "name": "contactStreet","size": 255,"required": false},{"type": "ftString", "name": "queueNumber","size": 255,"required": true},{"type": "ftString", "name": "packingCharges","size": 255,"required": true},{"type": "ftString", "name": "deliveryFee","size": 255,"required": true},{"type": "ftString", "name": "fullReductionRuleDescription","size": 255,"required": true},{"type": "ftString", "name": "couponsDescription","size": 255,"required": true},{"type": "ftString", "name": "remark","size": 255,"required": true},]',AData:e,BField:'[{"type": "ftString", "name": "goodsName","size": 255,"required": true},{"type": "ftString", "name": "specList","size": 255,"required": false},{"type": "ftString", "name": "number","size": 255,"required": false},{"type": "ftString", "name": "subtotal","size": 255,"required": false},]',BData:t};i.a.ajax({type:"post",url:"http://127.0.0.1:12345/printreport",async:!1,data:o.stringify(a),success:function(e){if(e=decodeURIComponent(e),console.log(e),""==e)r.$message({showClose:!0,message:"连接HttpPrinter失败，请重新启动程序",type:"error"});else{var t=JSON.parse(e);console.log(t.status+" -- "+("ok"==t.status)+" -- "+("OK"==t.status)),"ok"!=t.status&&r.$message({showClose:!0,message:"打印失败，请联系管理员",type:"error"})}},error:function(e){r.$message({showClose:!0,message:"连接HttpPrinter失败，请重新启动程序",type:"error"})}})},printOrderDetailLabel(e){let t=this;if(null==e||""==e)return t.$message({showClose:!0,message:"请输入订单信息",type:"error"}),!1;let r={ReportType:"fastreport",ReportName:"siamLabel.fr3",ReportVersion:1,ReportUrl:"",Copies:1,PrintOffsetX:0,PrintOffsetY:0,token:"aa",taskId:"1234567",exportfilename:"",exportfiletype:"",AField:'[{"type": "ftString", "name": "queueNumber","size": 255,"required": true},{"type": "ftString", "name": "shoppingWay","size": 255,"required": false},{"type": "ftString", "name": "goodsName","size": 255,"required": false},{"type": "ftString", "name": "specList","size": 255,"required": false},]',AData:e};i.a.ajax({type:"post",url:"http://127.0.0.1:12345/printreport",async:!1,data:o.stringify(r),success:function(e){(e=decodeURIComponent(e),console.log(e),""==e)?t.$message({showClose:!0,message:"连接HttpPrinter失败，请重新启动程序",type:"error"}):"ok"!=JSON.parse(e).status&&t.$message({showClose:!0,message:"打印失败，请联系管理员",type:"error"})},error:function(e){t.$message({showClose:!0,message:"连接HttpPrinter失败，请重新启动程序",type:"error"})}})},handleSizeChange(e){this.searchMsg.pageSize=e,this.getList()},handleCurrentChange(e){this.searchMsg.pageNo=e,this.getList(this.$route.query.id)},getRelatedList(e){let t=this,r={};r.id=e,t.relatedListLoading=!0,t.$http.post(t,"/rest/admin/order/list",r,(e,t)=>{e.relatedList=t.data.records,e.relatedListLoading=!1},(e,r)=>{t.relatedListLoading=!1,t.$message({showClose:!0,message:r.message,type:"error"})})},getList(e){let t=this,r=Object.assign(t.searchMsg);r.orderId=e,delete r.id,t.listLoading=!0,t.$http.post(t,"/rest/admin/orderDetail/list",r,(e,t)=>{e.list=t.data.records,e.total=t.data.total,e.listLoading=!1},(e,r)=>{alert(r),t.listLoading=!1,t.$message({showClose:!0,message:r.message,type:"error"})})},handleDel(e){this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(()=>{let t=this;t.$http.delete(t,"/rest/admin/orderDetail/delete",{ids:[e]},(function(e,t){e.$message({showClose:!0,message:t.message,type:"success"}),e.getList(this.$route.query.id)}),(function(e,r){t.$message({showClose:!0,message:r.message,type:"error"})}))}).catch(()=>{})},handleEdit:function(e,t){this.editFormVisible=!0,this.editForm=t?{id:t.id,name:t.name,amount:t.amount,remarks:t.remarks,createTime:new Date(t.createTime).getTime()}:{name:"",amount:"",remarks:"",createTime:""}},editSubmit:function(){this.$refs.editForm.validate(e=>{if(e){let e=this,t=Object.assign({},this.editForm),r=new Date(t.createTime),a=this.$utils.formatDate(r,"yyyy/MM/dd hh:mm:ss");t.createTime=a;let s="";t.id?s="/rest/admin/orderDetail/update":(s="/rest/admin/orderDetail/insert",t.orderId=this.$route.query.id),e.$http.post(e,s,t,(e,t)=>{e.$message({showClose:!0,message:t.message,type:"success"}),e.getRelatedList(this.$route.query.id),e.getList(this.$route.query.id),e.editFormVisible=!1},(t,r)=>{e.editFormVisible=!1,e.$message({showClose:!0,message:r.message,type:"error"})})}})}},created(){let e=this.$route.query.id;this.getRelatedList(e),this.getList(e)}},c=r(276),m=Object(c.a)(p,a,[],!1,null,"7de9544e",null);t.default=m.exports}}]);